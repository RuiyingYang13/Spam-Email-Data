---
title: "Spam Email Data"
author: "xx"
date: "23 Juni 2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = T, 
                      results = 'all', 
                      message = FALSE, 
                      warning = F, 
                      cache = FALSE, 
                      error=TRUE)
```

# Task 1, Conduct Exploratory Data Analysis (EDA), inspect the data set and preprocess the data
## Treat missing values, if applicable
```{r}
getwd()
```

```{r}
# Clean environment 
 rm(list = ls())  

# Installing packages 
# install.packages("pacman", repos = "http://cran.us.r-project.org")
library(pacman)
library("RColorBrewer")
p_load(ggplot2,    
       cowplot,   
       stargazer, 
       glmnet,    
       pROC,      
       caret,       
       rpart,        
       rpart.plot,
       moments)

# Reading in the data
spam <- read.csv("spam7.csv", sep = ",", stringsAsFactors = T, header = T)
str(spam)
summary(spam)
dollar_t <- table(spam$dollar == 0.00000)
bang_t <- table(spam$bang == 0.0000)
money_t <- table(spam$money == 0.00000)
n000_t <- table(spam$n000 == 0.0000)
make_t <- table(spam$make == 0.0000)

dollar_t 
bang_t 
money_t 
n000_t 
make_t 


# Inspect the data for explicit and implicit missing values 
# find explicit NAs
colSums(is.na(spam))
# find implicit NAs through empty cells
apply(spam, 2, function(g) sum(g == "")) 
```
*We can see from the results that there are many zeros in the data, they do not seem to be missing values, so we do not treat them. Other than that, there are no explicit or implicit NAs.*

## Handle sparse classes of categorical predictors, if applicable
```{r}
spam_categorical <- spam[,"yesno"]
table(spam_categorical)
```
*There is no need to do any changes to this categorical predictors.*

## Take care of outliers and skewed distributions, if applicable
For this task, only continuous variables need to be considered.
To treat outliers we will use `zScores` function:
```{r}
zScores <- function(var){
    mu <- mean(var)
    sd <-  sd(var)
    scores <- (var - mu)/sd
    return(scores)
}
```


### `crl.tot`
```{r}
ggplot(spam, aes(crl.tot)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Total length of words in capitals_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$crl.tot)
x <- zScores(spam$crl.tot)
summary(x)

spam$crl.tot[x>3]
spam$crl.tot[x>5]

for (var in c("crl.tot")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 3] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$crl.tot)
summary(spam$crl.tot_tr)

# examining the distribution of crl.tot_tr
par(mfrow = c(1,2))
plot(density(spam$crl.tot_tr),
     main     = "Total length of words in capitals_truncated",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$crl.tot_tr)),
     main     = "Total length of words in capitals_log",
     col      = "royalblue4", 
     cex.main = 0.7)
spam$crl.tot_ln <- log(spam$crl.tot_tr) 
summary(spam)

```

### `dollar`
```{r}
ggplot(spam, aes(dollar)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Number of occurrences of the $ symbol_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$dollar)
y <- zScores(spam$dollar)
summary(y)

spam$dollar[y>3]

for (var in c("dollar")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 3] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$dollar)
summary(spam$dollar_tr)

# examining the distribution of dollar_tr
par(mfrow = c(1,2))
plot(density(spam$dollar_tr),
     main     = "Total length of words in capitals",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$dollar_tr+0.00001)),
     main     = "Total length of words in capitals_log",
     col      = "royalblue4", 
     cex.main = 0.7)

skewness(spam$dollar_tr)              
skewness(log(spam$dollar_tr+0.00001))

spam$dollar_ln <- log(spam$dollar_tr+0.00001) 
summary(spam)

```

### `bang`
```{r}
ggplot(spam, aes(bang)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Number of occurrences of the ! symbol_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$bang)
m <- zScores(spam$bang)
summary(m)


spam$bang[m>3]

for (var in c("bang")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 3] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$bang)
summary(spam$bang_tr)

# examining the distribution of bang_tr
par(mfrow = c(1,2))
plot(density(spam$bang_tr),
     main     = "Number of occurrences of the ! symbol_truncated",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$bang_tr+0.0001)),
     main     = "Number of occurrences of the ! symbol_log",
     col      = "royalblue4", 
     cex.main = 0.7)

skewness(spam$bang_tr)              
skewness(log(spam$bang_tr+0.0001))

spam$bang_ln <- log(spam$bang_tr+0.0001) 
summary(spam)

```


### `money`
```{r}
ggplot(spam, aes(money)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Number of occurrences of the word ‘money’_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$money)
n <- zScores(spam$money)
summary(n)

spam$money[n>3]

for (var in c("money")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 3] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$money)
summary(spam$money_tr)

# examining the distribution of money_tr
par(mfrow = c(1,2))
plot(density(spam$money_tr),
     main     = "Number of occurrences of the word ‘money’_truncated",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$money_tr+0.0001)),
     main     = "Number of occurrences of the word ‘money’_log",
     col      = "royalblue4", 
     cex.main = 0.7)

skewness(spam$money_tr)              
skewness(log(spam$money_tr+0.0001))

spam$money_ln <- log(spam$money_tr+0.0001) 
summary(spam)
```


### `n000`
```{r}
ggplot(spam, aes(n000)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Number of occurrences of the string ‘000’_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$n000)
a <- zScores(spam$n000)
summary(a)

spam$n000[a>3]

for (var in c("n000")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 3] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$n000)
summary(spam$n000_tr)

# examining the distribution of n000_tr
par(mfrow = c(1,2))
plot(density(spam$n000_tr),
     main     = "Number of occurrences of the string ‘000’_truncated",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$n000_tr+0.0001)),
     main     = "Number of occurrences of the string ‘000’_log",
     col      = "royalblue4", 
     cex.main = 0.7)

skewness(spam$n000_tr)              
skewness(log(spam$n000_tr+0.0001))

spam$n000_ln <- log(spam$n000_tr+0.0001) 
summary(spam)
```


### `make`
```{r}
ggplot(spam, aes(make)) +
          geom_density(na.rm = T,
                       alpha = 0.15,
                       fill  = "royalblue",
                       colour = "grey50") +
          labs(title = "Number of occurrences of the word ‘make’_original") +
          theme(plot.title = element_text(color = "royalblue4", size = 12, face = "bold"))

summary(spam$make)
b <- zScores(spam$make)
summary(b)

spam$make[b>3]

for (var in c("make")) {
  x <- zScores(spam[[var]])
  new_var <- paste(var, "tr", sep = "_")
  spam[[new_var]] <- spam[[var]]
  spam[[new_var]][x > 1] <- mean(spam[[var]], na.rm = T) + 
  3*sd(spam[[var]], na.rm = T)
}

summary(spam$make)
summary(spam$make_tr)

# examining the distribution of make_tr
par(mfrow = c(1,2))
plot(density(spam$make_tr),
     main     = "Number of occurrences of the word ‘make’_truncated",
     col      = "royalblue4", 
     cex.main = 0.7)
plot(density(log(spam$make_tr+0.0001)),
     main     = "Number of occurrences of the word ‘make’_log",
     col      = "royalblue4", 
     cex.main = 0.7)

skewness(spam$make_tr)              
skewness(log(spam$make_tr+0.0001))

spam$make_ln <- log(spam$make_tr+0.0001) 
summary(spam)
```


## Explore the relationships between predictors and the target
```{r}
boxplot(crl.tot_tr~yesno, 
        data = spam,
        names    = c("NO", "YES"),
        col  = c("aquamarine4", "coral2"),
        xlab = "Are They Spam Email?",
        ylab = "Total length of words in capitals",
        main = "The Relationship Between Spam and Length of Words in Capitals",
        cex.lab  = 0.8,
        cex.main = 0.8)

boxplot(dollar_tr~yesno, 
        data = spam,
        ylim   = c(0,0.5),
        names    = c("NO", "YES"),
        col  = c("aquamarine4", "coral2"),
        xlab = "Are They Spam Email?",
        ylab = "Number of Occurrences of the $ Symbol",
        main = "The Relationship Between Spam and the Occurrences of the $ Symbol",
        cex.lab  = 0.8,
        cex.main = 0.8)
  

```









